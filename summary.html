
<!-- <script language="JavaScript" type="text/javascript" src="../biojs/dependencies/jquery/jquery-1.4.2.min.js"></script>
</script> -->
<style>
.arc path {
  stroke: #fff;
  
}
 .pie{
 	margin: 15px;
 	align: center;	
 } 

 .slice text {
            font-size: 16pt;
            font-family: Arial;
        }  


  .topright{
  		position: relative;
  		left: 850px;

  } 
 #tooltip {
          display: none;
         position: fixed;
          background-color: #fff;
          border: 1px solid #555;
          width: 120px;
          height: 20px;
          padding-left: 10px;
        }
  #prot-summary-html{
  		disply:none;

  }
</style>
<div id="tooltip"></div>

<ul class="nav nav-tabs">
	<li class="active"> <a id='menu-visual' href="#">Visual</a>  </li>
	<li>   <a id='menu-html' href="#">Old Format</a> </li> 
</ul>


  <div id="container">
  	<div id='prot-summary-vis'>
  		<div class='row'>
  			<h3>PredictProtein Summary for the <strong>CD44_HUMAN</strong><i class="icon-edit"></i> Protein</h3>
  		</div>
  		<div class="row">
  		 <div class="span4">
	  		<table class="table table-bordered">
	  			<tr><th>Sequence Length</th><td> <div id='seq-length'></div></td></tr>
	  			<tr><th>Number of Aligned Proteins</th><td> <div id=''></div></td></tr>
	  			<tr><th>Number of Chains</th><td> <div id=''></div></td></tr>
	  			<tr><th>Number of Matched PDB Modles</th><td> <div id=''></div></td></tr>
	  		</table>
	  	</div>
	  </div>
	  <div class="row">
	  	 <div class="span8">

	  		<h3>Residue Composition</h3>
		  	<div class="alert alert-info">
		  		<i class="icon-remove icon-white topright"></i>
		  		<strong>Good to know: </strong>
		  		<ul>
		  			<li>Certain amino acids occur at distinct structural sites up to six times more often than other amino acids.</li>
		  			<li>The amino acid composition at non-critical sites in protein structure may or may not contribute to the overall quality of a protein.</li>
		  			<li> If certain amino acids are optimal for protein structure, natural selection should have acted over evolutionary time to increase the frequency of these amino acids.</li>
		  			<li>An alternate hypothesis is that amino acid composition at a site is merely a random permutation of the genetic code.</li>
		  		</ul>	
		</div>
		  	<div id='aa-composition' class='pie span8 offset2'></div>
		 </div>
	  </div>
	<div class="row">
	  	<div class="span8">  
			<h3>Predicted Secondary-Structure Composition</h3>
			<div class="alert alert-info">
		  		<i class="icon-remove icon-white topright"></i>
		  		<strong>Good to know: </strong>
				Protein can be classified as <strong>mixed</strong> given the following classes:
				<ul>
					<li>'all-alpha':   %H &gt; 45% AND %E &lt;  5%</li>
					<li>'all-beta':    %H &lt;  5% AND %E &gt; 45%</li>
					<li>'alpha-beta':  %H &gt; 30% AND %E &gt; 20%</li>
					<li>'mixed':       All others</li>
				</ul>
			</div>
		  	<div id='SS-composition' class='pie span8 offset2'></div>
		 </div>
	</div>
	<div class="row">
	  	<div class="span8">  
	  	<h3>Predicted Solvent Accessibility Composition (core/surface ratio)</h3>
	  	<div>Some text here about something</div>
	  	<div id='SolvAcc-composition' class='pie span8 offset2'></div>
	  	</div>
	  </div>
  </div>

  <div  id='prot-summary-html'> </div>


<!-- <script language="JavaScript" type="text/javascript" src="../biojs/dependencies/jquery/jquery-1.4.2.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script> -->
<script>

$('.icon-remove').click(function(){ $(this).parent().hide();});

$('#menu-visual').click(function(){
		$(".active").removeClass('active');
		$(this).parent().addClass('active');
		$('#prot-summary-html').hide();
		$('#prot-summary-vis').show();
	});


$('#menu-html').click(function(){
	$(".active").removeClass('active');
	$(this).parent().addClass('active');
	$('.active-content').removeClass('active-content').addClass('inactive-content');
	$('#prot-summary-html').load('html_source/summary.html',  function(response, status, xhr) {
	  	if (status == "error") {
	  		alert (xhr.status)
	    	var msg = "Sorry but there was an error: ";
	    	$("#error").html(msg + xhr.status + " " + xhr.statusText);
	  	}
		$('#prot-summary-vis').hide();
		$('#prot-summary-html').show();
	});
});



var theSequence = '';

$.get('data/source4.xml', function(data) {
  	theSequence = $(data).find("sequence").text();
	theSequence = $.trim(theSequence).replace(/(\r\n|\n|\r)/gm,"");	
	$('#seq-length').text(theSequence.length);
	if (window.console) console.log(theSequence);
	
	var dataArr = [];
	var aas = 'acdefghiklmnpqrstvwy';
	for (var i=0;i< aas.length; i++){ 
		theSeq = theSequence.toLowerCase();
		var count = occurrences(theSeq, aas.charAt(i).toLowerCase());
		console.log (aas.charAt(i)+" " +count+ " times"); 
		dataArr.push ({AA:aas.charAt(i).toUpperCase(), count: count, per: ((count/theSequence.length)*100).toFixed(2)}); 
	}
	drawPieChart(dataArr, 'aa-composition');


	dataArr = [
 		{ AA: 'Helix', count: 6.9, per: 6.9},
 		{ AA: 'Extend', count: 9.2, per: 9.2},
 		{ AA: 'Loop', count: 84.0, per: 84.0},
	];
	drawPieChart(dataArr, 'SS-composition');

dataArr = [
 		{ AA: 'Buried', count: 22.6 , per: 22.6 },
 		{ AA: 'Exposed', count: 77.4, per: 77.4}
	];
	drawPieChart(dataArr, 'SolvAcc-composition');


});


function drawPieChart(dataArr, targetDiv){

	
   var w = 500,
    h = 400,
    r = Math.min(w, h) / 2;
   color = d3.scale.category20c();     //builtin range of colors
    


    // color = d3.scale.ordinal()
    // .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

    var vis = d3.select("#"+targetDiv)
        .append("svg:svg")              //create the SVG element inside the <body>
        .data([dataArr])                   //associate our data with the document
            .attr("width", w)           //set the width and height of our visualization (these will be attributes of the <svg> tag
            .attr("height", h)
        	.append("svg:g")                //make a group to hold our pie chart
            .attr("transform", "translate(" + r + "," + r + ")")    //move the center of the pie chart from 0, 0 to radius, radius
 
    var arc = d3.svg.arc()              //this will create <path> elements for us using arc data
        .outerRadius(r);
 
    var pie = d3.layout.pie()           //this will create arc data for us given a list of values
        .value(function(d) { return d.count; });    //we must tell it out to access the value of each element in our data array
 
    var arcs = vis.selectAll("g.slice")     //this selects all <g> elements with class slice (there aren't any yet)
        .data(pie)                          //associate the generated pie data (an array of arcs, each having startAngle, endAngle and value properties) 
        .enter()                            //this will create <g> elements for every "extra" data element that should be associated with a selection. The result is creating a <g> for every object in the data array
        .append("svg:g")                //create a group to hold each slice (we will have a <path> and a <text> element associated with each slice)
        .attr("class", "slice")    //allow us to style things in the slices (like text)
  		.attr("class", "arc");
        arcs.append("svg:path")
        .attr("fill", function(d, i) { return color(i); } ) //set the color for each slice to be chosen from the color function defined above
        .attr("d", arc)
                                      //this creates the actual SVG path using the associated data (pie) with the arc drawing function
 		.on('mouseover', function(d) {
                    $("#tooltip")
                      .html(d.data.AA+" : "+d.data.per+"%")
                      .show();
                })
                .on('mousemove', function(d) {
                    $("#tooltip")
                      .css('left', d3.mouse(this)[0]+500)
                      .css('top', d3.mouse(this)[1]+250)

                })
                .on('mouseout', function(d) {
                    $("#tooltip").html('').hide();
                });
        arcs.append("svg:text")                                     //add a label to each slice
                .attr("transform", function(d) {                    //set the label's origin to the center of the arc
                //we have to make sure to set these before calling arc.centroid
                d.innerRadius = 0;
                d.outerRadius = r;
                return "translate(" + arc.centroid(d) + ")";        //this gives us a pair of coordinates like [50, 50]
            })
            .attr("text-anchor", "middle")                          //center the text on it's origin
            .text(function(d, i) { return dataArr[i].AA.toUpperCase(); });        //get the label from our original data array
}

/** Function count the occurrences of substring in a string;
 * @param {String} string   Required. The string;
 * @param {String} subString    Required. The string to search for;
 * @param {Boolean} allowOverlapping    Optional. Default: false;
 */
function occurrences(string, subString, allowOverlapping){

    string+=""; subString+="";
    if(subString.length<=0) return string.length+1;

    var n=0, pos=0;
    var step=(allowOverlapping)?(1):(subString.length);

    while(true){
        pos=string.indexOf(subString,pos);
        if(pos>=0){ n++; pos+=step; } else break;
    }
    return(n);
}

</script>