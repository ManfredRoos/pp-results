
Biojs.ChEMBLCompound=Biojs.extend({constructor:function(options){Biojs.console.enable();jQuery("#"+this.opt.target).css("padding","0px").css("width",this.opt.width).css("height",this.opt.height).css("overflow","hidden");if(this.opt.id!==undefined){this.setId(this.opt.id);}},opt:{target:'YourOwnDivId',id:undefined,imageUrl:'https://www.ebi.ac.uk/chembldb/index.php/compound/displayimage/',detailsUrl:'https://www.ebi.ac.uk/chemblws/compounds/',proxyUrl:'../biojs/dependencies/proxy/proxy.php',height:400,width:597,scale:false,imageIndex:0},eventTypes:["onRequestError","onLoadedImage"],setId:function(chEMBLId){self=this;self.opt.id=chEMBLId;var dimension=Math.round(self.opt.width*0.7);var url=self.opt.imageUrl+chEMBLId;var image='<img id="image_'+chEMBLId+'" src="'+url+'"   />';jQuery("div#"+this.opt.target).html('<div id="div'+chEMBLId+'" style="position:relative; float:right;">'+image+'</div>'+'<div id="controlSection'+chEMBLId+'" style="position:relative; float:right;"/>');jQuery('#image_'+chEMBLId).load(function(){self.raiseEvent('onLoadedImage',{id:chEMBLId});}).css('height',self.opt.height).css('width',dimension);this._requestDetails(chEMBLId);},_requestDetails:function(chEMBLId){var self=this;Biojs.console.log('url='+self.opt.detailsUrl+chEMBLId+'.json');jQuery.ajax({url:self.opt.proxyUrl,dataType:'json',data:'url='+self.opt.detailsUrl+chEMBLId+'.json',success:function(json){Biojs.console.log("SUCCESS: data received from "+this.data);self._buildPanel(json.compounds);},async:false,error:function(qXHR,textStatus,errorThrown){Biojs.console.log(textStatus);self.raiseEvent('onRequestError',{message:textStatus});}});},_buildPanel:function(details){this._controlsVisible=false;Biojs.console.log(details);var self=this;var width=Math.round(self.opt.width*0.3);var height=self.opt.height;var controlSectionDiv=jQuery("#"+self.opt.target+" > div#controlSection"+self.opt.id);controlSectionDiv.append('<div id="controls" />'+'<div id="controlTab">'+'<span id="hideButton" title="Hide this control panel">&lt;&lt;</span>'+'<span id="showButton" title="Show the control panel">&gt;&gt;</span><br/><br/></div>').css("border",0).css("margin",0).css("width","auto").css("height","auto").css('float','left').css('font-family','"Heveltica Neue", Arial, "sans serif"').css('font-size','12px');var padding=5;var tabWidth=20,tabHeight=height;var controlsWidth=width-(2*padding+tabWidth),controlsHeight=height-(padding*2);var controlDiv=controlSectionDiv.find("div#controls");var detailsHTML='';for(key in details){if(details[key].length>0){detailsHTML+='<b>'+key+':</b><br/>'+details[key]+'<br/><br/>';}}
controlDiv.css("position","relative").css("border",0).css("margin",0).css('background-color',"#000").css('color',"#fff").css('float','left').css("width",controlsWidth).css("height",controlsHeight).css("padding",padding).append(detailsHTML);var showHideTab=controlSectionDiv.find('#controlTab');showHideTab.css("border",0).css("margin",0).css("padding",0).css("float","left").css("width",tabWidth).css("height",tabHeight).css('background-color',"#000");var toggleControls=function(){showHideTab.find("span").toggle();if(self._controlsVisible){controlDiv.hide();self._controlsVisible=false;}else{controlDiv.show();self._controlsVisible=true;}}
self._toggleControls=toggleControls;showHideTab.find('#hideButton').click(self._toggleControls).mouseover(function(){jQuery(this).css("color","#27C0FF");}).mouseout(function(){jQuery(this).css("color","#fff");}).css("color","#fff").css("display","none").css("cursor","pointer");showHideTab.find('#showButton').click(self._toggleControls).mouseover(function(){jQuery(this).css("color","#27C0FF");}).mouseout(function(){jQuery(this).css("color","#000");}).css("color","#000").css("cursor","pointer");this._controlsReady=true;Biojs.console.log("_buildPanel done");}});