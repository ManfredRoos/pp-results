
Biojs.InteractionsGraph=Biojs.Cytoscape.extend({constructor:function(options){var instance=this;options.layout=(options.layout===undefined)?instance.opt.layout:options.layout;options.style=(options.style===undefined)?instance.opt.style:options.style;options.calculateWeight=(options.calculateWeight===undefined)?instance.opt.calculateWeight:options.calculateWeight;var fk=instance.base;var callback=function(data){options.elements=instance._decodeToJSON(data);fk(options);}
instance._options=options;instance._fetchData(options.dataSource,callback);},opt:{target:"YourOwnDivId",dataSource:{psicquicUrl:'http://www.ebi.ac.uk/Tools/webservices/psicquic/intact/webservices/current/search/query',proxyUrl:'../biojs/dependencies/proxy/proxy.php',query:"brca2"},layout:{name:"arbor"},style:{selectors:{node:{fillColor:"#888",height:{continuousMapper:{attr:{name:"weight",min:0,max:100},mapped:{min:15,max:30}}},width:{continuousMapper:{attr:{name:"weight",min:0,max:100},mapped:{min:15,max:30}}},labelText:{passthroughMapper:"id"}},edge:{lineColor:"#CCC"},"node:selected":{fillColor:"#333"},"edge:selected":{lineColor:"#666"}}},calculateWeight:true},eventTypes:[],_fetchData:function(dataSource,fnCallback){var httpRequest={url:dataSource.psicquicUrl};httpRequest.dataType='text';httpRequest.type='GET';httpRequest.success=fnCallback;if(dataSource.proxyUrl!=undefined){httpRequest.url=dataSource.proxyUrl;httpRequest.data=[{name:"url",value:dataSource.psicquicUrl+"/"+dataSource.query}];}
jQuery.ajax(httpRequest);},_decodeToJSON:function(mitabData){var node_names=[];var nodes=[];var edges=[];var lines=mitabData.split('\n');for(var i=0;i<lines.length;i++){var line=lines[i].split('\t');if(line.length>1){var idA=this._addNode(this._extractId(line[0]),node_names,nodes);var idB=this._addNode(this._extractId(line[1]),node_names,nodes);var edge={data:{id:i,source:idA,target:idB}};edges.push(edge);}}
return{nodes:nodes,edges:edges};},_addNode:function(id,node_names,nodes){var pos=jQuery.inArray(id,node_names);if(pos===-1){node_names.push(id);nodes.push({data:{id:id,weight:10}});}else{if(this._options.calculateWeight){nodes[pos].data.weight+=10;}}
return id;},_extractId:function(str){str=str.split('|')[0];str=(str.indexOf(':')==-1)?str:str.substring(str.indexOf(':')+1);return str;}});